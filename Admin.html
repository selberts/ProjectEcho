<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="assets/ico/favicon.png">

    <title>Project Echo - IM Scheduler</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">

    <!-- Database calls source-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>

  <body onload="makeslots()">

    <!-- Fixed navbar -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="index.html">NU INTRAMURAL SP<i class="fa fa-circle"></i>RTS</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="index.html">HOME</a></li>
            <li><a href="about.html">ABOUT</a></li>
            <li><a href="calendar.html">CALENDAR</a></li>
            <li><a href="schedule.html">SCHEDULE</a></li>
            <li class="active"><a href="Admin.html">Admin</a></li>
            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    
    	<div id="dg">
		<div class="container">
			<div class="row centered">
				<h4>ADD TIMESLOTS</h4>
				
				<form id="password" style="display: inline-block" onsubmit="return submitPass()">
                                    Password: <input type="password" id="adminpassword"/>
                                    <input type="submit" value="Submit">
                                </form>
                                
        
        <form id="team_info" style="display: none" onsubmit="return sub()">
                                    <input type="button" id="addpref" value="Add pref" onclick="createPref()"/>
                                    <input type="submit" value="Submit">
                                </form>
        <script type="text/javascript">

            Parse.initialize("r3WndIFb85R0lx1qhchN4nquvAQVeKVrkA3TBnpI", "Wui7puCTZpnTmA5ZLvJmlj5R044vAyDerOBXhYzq");
            
            function passwordCheck(pwd){



Parse.initialize("r3WndIFb85R0lx1qhchN4nquvAQVeKVrkA3TBnpI", "Wui7puCTZpnTmA5ZLvJmlj5R044vAyDerOBXhYzq");

// Select the table Teamdata in the database
var PWT = Parse.Object.extend("Password");
// Prepare a query
var query = new Parse.Query(PWT);
// Find all the tuples in the table
query.equalTo("type", "password");
// Get the results set of the query
query.find().then(function(results){   //the results set can only be accessed in this function!!!
        var b = false;
        for(var i=0;i<results.length;i++){
    	var object = results[i];
    	var password = object.get("password");
        if(pwd == password){
        	b = true;
        }
    }

    if(b){

    	Succeed();

    }else{
    	alert("Incorrect password");
    }

});

}


function Succeed(){
	
	var teamform = document.getElementById('team_info');
	var passform = document.getElementById('password');

	teamform.style.display = 'inline-block';
	passform.style.display = 'none';
}
            
            function submitPass(){
            	
            	var pwd = document.getElementById("adminpassword").value;
            	
            	passwordCheck(pwd);
            	
            	return false;
            }
            /**
             * Callback function for form submission
             * Prepares name and pref_times, pref_days arrays for local storage
             * @returns {bool}  false signals page not to reload (ie, not sending info to webserve)
             */
            function sub(){
                /*  Uncomment to require 3 preferences 
               if(prefNum != 3) {
                   alert("Need to add three preferences");
                   return false;
               }
               */

               var daySelects = document.getElementsByName("prefDay");
               var timeSelects = document.getElementsByName("prefTime");
               
               if(daySelects.length == 0 || timeSelects.length == 0){
               		alert("Must submit at least one timeslot");
               		return false;
               }
               var timeslots = new Array();
               
               // Check for duplicates
               while(removeDuplicate(daySelects, timeSelects)) {}
               if(removed > 0) alert("Removed " + removed + " duplicate timeslots");
               removed = 0;
               
               
               for(var i=0; i<daySelects.length; i++){ 
               		var time = timeSelects.item(i).value;
               		var day = daySelects.item(i).value;
                	 timeslots.push(new Time_Slot(i, time, day, 2));
               }
               
               /* Submit to database here*/
               alert(timeslots);
               return false;
               /*
               var Teamdata = Parse.Object.extend("Teamdata");
               var teamdata = new Teamdata();
               teamdata.save({team_name: name , type:"team" , pref_days:pref_days , pref_times:pref_times}).then(function(object) {
	      console.log("Team successfully added.");
	      var success = document.createElement("div");
	      var loc = document.getElementById('dg');
	      success.innerHTML = "Timeslot successfully added to database";
	      success.style.display = 'block';
	      loc.appendChild(success);
	      
               });

               
               

               return false; */
                
            }
            var removed = 0;
            function removeDuplicate(daySelects, timeSelects){
            	var i;
            	var remove = false;
            	
               loop1:
               for(i=0; i<timeSelects.length; i++){
               	for(var j=i+1; j<timeSelects.length; j++){
               		if(timeSelects.item(i).value === timeSelects.item(j).value){
               			if(daySelects.item(i).value === daySelects.item(j).value){
               				remove = true;
               				break loop1;
               			}
               		}
               	}
               }
               
               if(!remove) return false;
               
       		var day = daySelects.item(i);
       		var form = document.getElementById('team_info');
       		form.removeChild(day.parentNode);
       		removed++;
       		
       		
       		return true;
            }
            
            var prefNum = 0;
            var days = ["Sunday", "Monday","Tuesday","Wednesday","Thursday"];
            var times = new Array();

            function makeslots() {
			for (var time = 5; time < 10; time ++)
					times.push(time + " PM");

            }

            
            /**
             * Adds preference selects (time, day) to form
             * Limited to 3 preferences 
             * @returns {undefined}
             */
            function createPref(){
                var form = document.getElementById('team_info');
                var button = document.getElementById('addpref');
                
                var remove = document.createElement("BUTTON");
                remove.id = "remove" + prefNum;
                remove.onclick = removeEntry;
                var text = document.createTextNode("Remove");
                remove.appendChild(text);
                
                var div = document.createElement("div");
                div.style.display = 'block';
                div.appendChild(createTimeSelect(prefNum));
                div.appendChild(createDaySelect(prefNum));
                div.appendChild(remove);
                form.insertBefore(div, button);
                
                prefNum++;
                if(prefNum == 100) form.removeChild(button);
            }
            
            var removeEntry = function(e){
            	e = e || window.event;
    		e = e.target || e.srcElement;
    		
            	var form = e.parentNode.parentNode;
            	
            	form.removeChild(e.parentNode);
            }
            
            /**
             * Creates a select with values for each of the time preference choices
             * @param {int} prefNum                         Preference number                      
             * @returns {createTimeSelect.select|Element}   Select created
             */
            function createTimeSelect(prefNum){
                var select = document.createElement("select");
                select.name = "prefTime";// + prefNum;
                
                for (var i = 0; i < times.length; i++){
                    var opt = document.createElement('option');
                    opt.value = times[i];
                    opt.innerHTML = times[i];
                    select.appendChild(opt);
                }
                
                return select;
            }
            
            /**
             * Creates a select with values for each of the day preference choices
             * @param {int} prefNum                         Preference number                      
             * @returns {createTimeSelect.select|Element}   Select created
             */
            function createDaySelect(prefNum){
                var select = document.createElement("select");
                select.name = "prefDay";// + prefNum;
                
                for (var i = 0; i < days.length; i++){
                    var opt = document.createElement('option');
                    opt.value = days[i];
                    opt.innerHTML = days[i];
                    select.appendChild(opt);
                }
                
                return select;
            }
            
        </script>





        <script src="calendarAPI.js"></script>
        <script src="Classes.js"></script>



			</div><!-- row -->
		</div><!-- container -->
	</div><!-- DG -->
